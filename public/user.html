<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>๐จ ุฅุฑุณุงู ุจูุงุบ ุญุงุฏุซ</title>

    <link rel="stylesheet" href="./style.css" />

    <!-- โ Socket.IO & SweetAlert -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- โ ArcGIS -->
    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.30/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.30/"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("token");
        if (!token) {
          Swal.fire({
            icon: "warning",
            title: "๐ซ ููููุน",
            text: "ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ูููุตูู ููุฐู ุงูุตูุญุฉ",
            confirmButtonText: "ุชุณุฌูู ุงูุฏุฎูู",
          }).then(() => {
            window.location.href = "login.html";
          });
          return; // ูููู ุชูููุฐ ุฃู ููุฏ ุขุฎุฑ
        }

        initMap();
      });
    </script>

    <style>
      html,
      body,
      #map {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
      .sidebar {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #fff;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        width: 280px;
        z-index: 99;
      }
    </style>

    <script>
      const socket = io("http://localhost:2511", {
        transports: ["websocket"],
        reconnection: true,
        reconnectionAttempts: 5,
        reconnectionDelay: 1000,
      });

      socket.on("connect", () => {
        console.log("๐ข Connected to server:", socket.id);
      });

      socket.on("connect_error", (err) => {
        console.error("โ Socket.IO error:", err.message);
      });
    </script>
  </head>
  <body>
    <div id="map"></div>
    <div class="overlay"></div>

    <div class="status-badge">
      <div class="status-indicator"></div>
      <span>ูุชุตู ุจุงูุฎุงุฏู</span>
    </div>

    <div class="report-panel">
      <div class="panel-header">
        <div class="decorative-circle circle-1"></div>
        <div class="decorative-circle circle-2"></div>
        <span class="header-icon">๐จ</span>
        <h1 class="header-title">ูุธุงู ุงูุจูุงุบุงุช ุงูุทุงุฑุฆุฉ</h1>
        <p class="header-subtitle">ุฅุฑุณุงู ุจูุงุบ ุญุงุฏุซ ููุฑู</p>
      </div>

      <div class="panel-body">
        <form id="reportForm" onsubmit="return false;">
          <div class="form-group">
            <button id="getLocationBtn" type="button" class="btn btn-location">
              <span>๐</span>
              <span>ุชุญุฏูุฏ ูููุนู ุงูุญุงูู</span>
            </button>
          </div>
          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">โ๏ธ</span>
              <span>ุฏุฑุฌุฉ ุงูุฎุทูุฑุฉ</span>
            </label>
            <div class="input-wrapper">
              <select id="severity" required>
                <option value="">ุงุฎุชุฑ ุฏุฑุฌุฉ ุงูุฎุทูุฑุฉ</option>
                <option value="Normal">ุนุงุฏูุฉ</option>
                <option value="Moderate">ูุชูุณุทุฉ</option>
                <option value="Critical">ุฎุทูุฑุฉ</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">๐ฅ</span>
              <span>ุนุฏุฏ ุงููุตุงุจูู</span>
            </label>
            <div class="input-wrapper">
              <input
                type="number"
                id="injuries"
                placeholder="ุฃุฏุฎู ุนุฏุฏ ุงููุตุงุจูู"
                min="0"
              />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">๐</span>
              <span>ูุตู ุงูุญุงุฏุซ</span>
            </label>
            <div class="input-wrapper">
              <textarea
                id="desc"
                placeholder="ุงูุชุจ ุชูุงุตูู ุงูุญุงุฏุซ ููุง..."
              ></textarea>
            </div>
          </div>

          <button type="submit" class="btn btn-submit">
            <span>๐ค</span>
            <span>ุฅุฑุณุงู ุงูุจูุงุบ ุงูุขู</span>
          </button>
        </form>
      </div>
    </div>

    <script src="./main.js"></script>
  </body>
</html>
